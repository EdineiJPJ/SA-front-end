<!DOCTYPE html>
<html lang="pt-br">

<head>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Colaboradores</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-Light barra">
      <div class="container-fluid">
        <a class="navbar-brand" href="#"><img class="logo-tamanho" src="../Pessoas/img/teste.PNG" alt=""></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="../Inicio/index.html">Inicio</a>
    
            </li>
           
         
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Pessoa
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="../Pessoas/cadastrarPessoas.html">Cadastrar pessoa</a></li>
                <li><a class="dropdown-item" href="../Pessoas/tabelaPessoas.html">Tabela de pessoas</a></li>
              </ul>
            </li>
    
            </li>
            <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Emprestimo
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="../Emprestimo/cadastro_emprestimo.html">Cadastrar emprestimo</a></li>
            <li><a class="dropdown-item" href="../Emprestimo/tabela2.html">Tabela emprestimo</a></li>
          </ul>
        </li>   
    
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Item
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="../Item/item.html">Cadastrar Itens</a></li>
              <li><a class="dropdown-item" href="../Item/listaItem.html">Tabela de Itens</a></li>
              <li><a class="dropdown-item" href="../TipoItem/tipo-item.html">Cadastrar Tipos de Itens</a></li>
            </ul>
          </li>
  
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Usuário
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="../Usuario/usuario.html">Cadastrar usuario</a></li>
             
            </ul>
          </li>

          </ul>
        </div>
      </div>
    </nav>


    
    <div class="container mt-3">
        <h2 id="titulo">Cadastro de pessoas</h2>
        <hr>
        <form id="formpessoa">

          <input type="hidden" id="id" value="">
          <div class="row">
          <div class="col-md-6">
              <label for="nome">Nome</label>
              <input type="text" id="nome" class="form-control" required>
          </div>
          <div class="col-md-6">
              <label for="CPF">CPF</label>
              <input type="text" id="cpf" class="form-control" required>
          </div>
          <div class="mt-3 botoes text-center">
            <button type="button" class="btn btn-primary" onclick="salvarPessoa()">Salvar</button>
            <a href="tabelaPessoas.html" class="btn btn-secondary">Cancelar</a>
        </div>
      </div>


    </div>

    <script>
      async function carregarProfissoes() {
          try {
              const response = await fetch('https://localhost:3004/profissao');
              const profissoes = await response.json();

              const selectProfissao = document.getElementById('profissao');

              profissoes.forEach(profissao => {
                  const option = document.createElement('option');
                  option.value = profissao.id;
                  option.textContent = profissao.nome;
                  selectProfissao.appendChild(option);
              });
          } catch (error) {
              console.error('Erro ao carregar profissões:', error);
          }
      }

      async function carregarpessoa() {
          const params = new URLSearchParams(window.location.search);
          const id = params.get('id');

          await carregarProfissoes(); 

          if (id) {
              document.getElementById('titulo').innerText = 'Editar Pessoa';

              const response = await fetch(`https://cefb9c9b-1c49-4c67-9064-bd6b7509fdf7.mock.pstmn.io/pessoas/?id=${id}`);
              const pessoa = await response.json();

              document.getElementById('id').value = pessoa.id;
              document.getElementById('nome').value = pessoa.nome;
              document.getElementById('cpf').value = pessoa.cpf;
          }
      }

      async function salvarPessoa() {
          const id = document.getElementById('id').value;
          const nome = document.getElementById('nome').value;
          const cpf = document.getElementById('cpf').value;

          const response = await fetch('http://localhost:3000/api/pessoas', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                  id: id ? parseInt(id) : undefined,
                  nome, cpf
              })
          });

          if (response.ok) {
              alert('Pessoa salva com sucesso!');
              window.location.href = 'listagem.html';
          }
      }

      carregarpessoa();
  </script>

</body>

</html>